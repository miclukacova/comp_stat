<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Log-logistic Dose-response Curves</title>
    <meta charset="utf-8" />
    <meta name="author" content="Christian Rubjerg Hejstvig-Larsen (brf337)" />
    <meta name="author" content="Dina Gyberg Jensen (vbz248)" />
    <meta name="date" content="2024-10-18" />
    <script src="4---Presentation_files/header-attrs-2.28/header-attrs.js"></script>
    <link href="4---Presentation_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
    <script src="4---Presentation_files/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <script src="4---Presentation_files/jquery-1.12.4/jquery.min.js"></script>
    <script src="4---Presentation_files/d3-3.5.6/d3.min.js"></script>
    <link href="4---Presentation_files/profvis-0.3.6.9000/profvis.css" rel="stylesheet" />
    <script src="4---Presentation_files/profvis-0.3.6.9000/profvis.js"></script>
    <script src="4---Presentation_files/profvis-0.3.6.9000/scroll.js"></script>
    <link href="4---Presentation_files/highlight-6.2.0/textmate.css" rel="stylesheet" />
    <script src="4---Presentation_files/highlight-6.2.0/highlight.js"></script>
    <script src="4---Presentation_files/profvis-binding-0.3.8/profvis.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Log-logistic Dose-response Curves
]
.author[
### Christian Rubjerg Hejstvig-Larsen (brf337)
]
.author[
### Dina Gyberg Jensen (vbz248)
]
.institute[
### University of Copenhagen
]
.date[
### 2024-10-18
]

---

&lt;style type="text/css"&gt;
.remark-slide-content {
    font-size: 18px;
        padding: 1em 4em 1em 4em;
    }
.remark-slide-content &gt; h1 {
  font-size: 40px;
}
.remark-slide-scaler {
    overflow-y: auto;
    overflow-x: auto;
}
&lt;/style&gt;





###Introduction
Objective is to use stochastic optimization to estimate the parameters of a log-logistic dose-response model using non-linear least squares estimation. That is obtaining the parameters `\(\alpha, \beta, \gamma, \rho\)` that minimize the loss function:
`$$L(X,(\alpha,\beta,\gamma,\rho))=\frac{1}{N}\sum_{i=1}^N\left( y_i - f(x_i| \alpha, \beta,\gamma,\rho)\right)^2$$`
&lt;br&gt;
Where the response is given by:
`$$Y_i = f(x_i| \alpha, \beta,\gamma,\rho) + \varepsilon_i \hskip5mm \text{with}\hskip2mm \varepsilon_i \stackrel{iid}{\sim} N(0,\omega^2)$$`
And the log-logistic dose-response model is given by:
`$$f(x_i| \alpha, \beta,\gamma,\rho) = \gamma + \frac{\rho - \gamma}{1 + \exp(\beta \log(x_i) - \alpha)}$$`

---
###Stochastic Gradient Descent
Start out implementing a standard version of the stochastic gradient descent algorithm (SGD). The gradient in a single point is given by
$$-2\cdot\nabla f(x_i| \alpha, \beta,\gamma,\rho)\cdot\left(y_i - f(x_i| \alpha, \beta,\gamma,\rho)\right)  $$

&lt;br&gt;
Where `\(\nabla f(x_i| \alpha, \beta,\gamma,\rho)\)` is given by
`$$\nabla f(x_i| \alpha, \beta,\gamma,\rho) = \begin{pmatrix}
  \frac{\rho-\gamma}{(1+\exp(\beta\log(x_i)-\alpha))^2}\cdot\exp(\beta\log(x_i)-\alpha)\\
  \frac{\rho-\gamma}{(1+\exp(\beta\log(x_i)-\alpha))^2}\cdot\exp(\beta\log(x_i)-\alpha)\cdot\log(x_i)\\
  1-\frac{1}{1+\exp(\beta\log(x_i)-\alpha)} \\
  \frac{1}{1+\exp(\beta\log(x_i)-\alpha)}
\end{pmatrix}$$`
So the update scheme becomes:
`$$\theta_{t+1} = \theta_t +2 \gamma_t\cdot\nabla f(x_i| \alpha, \beta,\gamma,\rho)\cdot\left(y_i - f(x_i| \alpha, \beta,\gamma,\rho)\right)$$`
Where `\(\theta_t = (\alpha_t, \beta_t, \gamma_t, \rho_t)\)` and `\(\gamma_t\)` is the learning rate at time `\(t\)`.
---
###Implementation
The gradient function and `\(f\)` are implemented seperately

``` r
sgd &lt;- function(
    par0,
    N, # Sample size
    gamma, # Decay schedule or a fixed learning rate
    epoch = NULL,
    maxiter = 100, # Max epoch iterations
    sampler = sample, # How data is resampled. Default is a random permutation
    cb = NULL,
    ...) {
  
  if (is.function(gamma)) gamma &lt;- gamma(1:maxiter)
  gamma &lt;- rep_len(gamma, maxiter)
  
  par &lt;- par0
  
  for (n in 1:maxiter) {
    if (!is.null(cb)) cb$tracer()
    
    samp &lt;- sampler(N)
    
    if (is.null(epoch)){
       for (j in 1:N) {
         i &lt;- samp[j]
         par &lt;- par - gamma[n] * gradient(par, i, ...)
       }
    } else {
      par &lt;- epoch(par, samp, gamma[n], ...)
    }
  }
  par
}
```

---
###Testing
We implement two types of samplers to test our data on. One that samples the `\(x_i\)`'s from the grid `\(e, e^2, ..., e^{15}\)` and one that samples `\(\log(x)\)` from `\(\mathcal{N}(0, \omega^2)\)`. We then test the algorithm on both samplers for 3 different values of parameters and 2 different starting values. Maybe??? Maybe not???

``` r
source("SO_source.R")
#Remember to source the SO_source file
set.seed(17102024)
param1 &lt;- parameters(5,2,1,2)
param2 &lt;- parameters(4,3,6,1)
param3 &lt;- parameters(1,1,1,1)
#Simulations of data
sim_1 &lt;- sim(param1, 1000)
sim_2 &lt;- sim(param2, 1000)
sim_3 &lt;- sim(param3, 1000)
sim_grid_1 &lt;- sim(param1, 1000, grid = TRUE)
sim_grid_2 &lt;- sim(param2, 1000, grid = TRUE)
sim_grid_3 &lt;- sim(param3, 1000, grid = TRUE)

#Running the SGD algorithm
```

---
###Profiling the algorithm
<div class="profvis html-widget html-fill-item" id="htmlwidget-838547a92b7123554308" style="width:100%;height:600px;"></div>
<script type="application/json" data-for="htmlwidget-838547a92b7123554308">{"x":{"message":{"prof":{"time":[1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,5,5,6,6,6,7,7,7,7,8,8,8,9,9,9,9,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18,19,19,19,19,20,20,20,21,21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26,26,27,27,27,28,28,28,28,29,29,29,29,30,30,31,31,31,32,32,32,32,33,33,33,34,34,34,35,35,35,36,36,37,37,37,38,38,38,39,39,39,39,40,40,40,41,41,41,41,42,42,42,43,43,43,43,44,44,44,45,45,45,46,46,46,47,48,48,48,49,49,49,49,50,50,50,51,51,51,52,52,52,53,53,53,54,54,54,55,55,55,56,56,56,57,57,57,58,58,58,59,59,59,60,60,60,61,61,61,62,62,62,63,63,63,63,64,64,64,65,65,65,66,66,66,67,67,67,68,68,68,69,69,69,70,70,70,70,71,71,71,72,73,73,73,73,74,75,75,75,75,76,77,77,77,78,78,79,79,79,80,80,80,81,81,81,82,82,82,83,83,83,84,84,84,85,85,85,86,86,86,87,87,87,88,88,88,89,89,89,90,90,90,90,91,91,91,92,92,92,93,93,93,94,94,94,95,95,95,96,96,96,97,97,97,98,98,98,99,100,101,101,101,102,102,102,103,103,103,104,104,104,105,105,105,106,106,106,106,107,107,107,108,108,108,109,109,109,110,110,110,111,111,111,112,112,113,113,114,114,114,115,115,115,116,116,116,117,117,117,118,119,119,119,120,120,120,121,121,121,122,123,123,123,124,124,124,125,125,125,125,126,126,126,127,127,127,127,128,128,128,129,130,130,130,131,131,131,132,133,133,133,134,135,135,135,135,136,136,136,137,137,137,137,138,138,138,139,139,139,140,140,140,140,141,141,141,142,142,142,143,143,143,144,144,144,145,145,145,146,146,146,147,147,147,148,148,148,149,149,149,150,150,150,151,151,151,152,152,152,153,153,153,154,154,154,154,155,155,155,156,156,156,156],"depth":[2,1,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,3,2,1,2,1,3,2,1,4,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,4,3,2,1,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,4,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,1,4,3,2,1,1,4,3,2,1,1,3,2,1,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,1,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,2,1,2,1,3,2,1,3,2,1,3,2,1,3,2,1,1,3,2,1,3,2,1,3,2,1,1,3,2,1,3,2,1,4,3,2,1,3,2,1,4,3,2,1,3,2,1,1,3,2,1,3,2,1,1,3,2,1,1,4,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,3,2,1,4,3,2,1,3,2,1,4,3,2,1],"label":["Rprof","profvis","make.argContext","cmpSubsetDispatch","h","tryInline","cmpCall","cmp","cmpSymbolAssign","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","getFoldFun","constantFoldCall","constantFold","constantFoldCall","constantFold","cmp","cmpPrim2","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","cmpPrim2","h","tryInline","cmpCall","cmp","genCode","cmpCallArgs","cmpCallSymFun","cmpCall","cmp","cmpSymbolAssign","h","tryInline","cmpCall","cmp","h","tryInline","cmpCall","cmp","genCode","cmpfun","compiler:::tryCmpfun","mean","grad","sgd","par <- par - gamma[n] * grad(par, i, ...)","sgd","mean.default","grad","sgd","isTRUE","mean.default","grad","sgd","mean","grad","sgd","isTRUE","mean.default","grad","sgd","mean.default","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","mean","grad","sgd","isTRUE","mean.default","grad","sgd","mean.default","grad","sgd","mean.default","grad","sgd","grad_rho <- mean(identical_part / (1 + expbetalogxalpha))","grad","sgd","grad_alpha <- mean(identical_part * (rho - gamma) * expbetalogxalpha / (1 + expbetalogxalpha)^2)","grad","sgd","isTRUE","mean.default","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","grad_beta <- - mean(identical_part * (rho - gamma) * log(x[i]) * expbetalogxalpha / (1 + expbetalogxalpha)^2)","grad","sgd","mean","grad","sgd","isTRUE","mean.default","grad","sgd","<GC>","mean","grad","sgd","grad","sgd","mean","grad","sgd","isTRUE","mean.default","grad","sgd","mean","grad","sgd","grad_rho <- mean(identical_part / (1 + expbetalogxalpha))","grad","sgd","mean","grad","sgd","<GC>","is.numeric","mean","grad","sgd","rho <- par[4]","grad","sgd","grad_rho <- mean(identical_part / (1 + expbetalogxalpha))","mean","grad","sgd","mean","grad","sgd","return(gamma + (rho - gamma) / (1 + exp(beta * log(x) - alpha)))","f","grad","sgd","mean","grad","sgd","<GC>","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","length","mean","grad","sgd","isTRUE","mean.default","grad","sgd","mean.default","grad","sgd","identical_part <- - 2 * (y_i - f(x_i, par))","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","gamma <- par[3]","grad","sgd","mean","grad","sgd","mean","grad","sgd","identical_part <- - 2 * (y_i - f(x_i, par))","grad","sgd","mean","grad","sgd","return(c(grad_alpha, grad_beta, grad_gamma, grad_rho))","grad","sgd","mean","grad","sgd","return(c(grad_alpha, grad_beta, grad_gamma, grad_rho))","grad","sgd","<GC>","rho <- par[4]","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","expbetalogxalpha <- exp(beta * log(x_i) - alpha)","grad","sgd","mean","grad","sgd","mean","grad","sgd","<GC>","mean","grad","sgd","mean","grad","sgd","length","isTRUE","mean.default","grad","sgd","is.numeric","beta <- par[2]","f","grad","sgd","is.numeric","mean.default","grad","sgd","par <- par - gamma[n] * grad(par, i, ...)","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","expbetalogxalpha <- exp(beta * log(x_i) - alpha)","grad","sgd","mean","grad","sgd","gamma <- par[3]","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","mean","grad","sgd","<GC>","grad_rho <- mean(identical_part / (1 + expbetalogxalpha))","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","return(c(grad_alpha, grad_beta, grad_gamma, grad_rho))","grad","sgd","mean","grad","sgd","mean","grad","sgd","alpha <- par[1]","grad","sgd","mean.default","grad","sgd","return(c(grad_alpha, grad_beta, grad_gamma, grad_rho))","grad","sgd","c","is.numeric","mean","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","grad_rho <- mean(identical_part / (1 + expbetalogxalpha))","grad","sgd","grad_beta <- - mean(identical_part * (rho - gamma) * log(x[i]) * expbetalogxalpha / (1 + expbetalogxalpha)^2)","grad","sgd","isTRUE","mean.default","grad","sgd","mean.default","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","for (j in 1:N) {","sgd","par <- par - gamma[n] * grad(par, i, ...)","sgd","grad_alpha <- mean(identical_part * (rho - gamma) * expbetalogxalpha / (1 + expbetalogxalpha)^2)","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","length","mean","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","is.numeric","mean","grad","sgd","mean","grad","sgd","grad_beta <- - mean(identical_part * (rho - gamma) * log(x[i]) * expbetalogxalpha / (1 + expbetalogxalpha)^2)","mean","grad","sgd","mean","grad","sgd","isTRUE","mean.default","grad","sgd","mean.default","grad","sgd","c","mean","grad","sgd","return(c(grad_alpha, grad_beta, grad_gamma, grad_rho))","grad","sgd","sgd","mean","grad","sgd","is.na","return(gamma + (rho - gamma) / (1 + exp(beta * log(x) - alpha)))","f","grad","sgd","mean","grad","sgd","<GC>","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","rho <- par[4]","f","grad","sgd","identical_part <- - 2 * (y_i - f(x_i, par))","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","mean","grad","sgd","grad_rho <- mean(identical_part / (1 + expbetalogxalpha))","grad","sgd","mean","grad","sgd","mean.default","grad","sgd","mean.default","grad","sgd","mean.default","grad","sgd","mean","grad","sgd","mean","grad","sgd","return(gamma + (rho - gamma) / (1 + exp(beta * log(x) - alpha)))","f","grad","sgd","mean","grad","sgd","isTRUE","mean.default","grad","sgd"],"filenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,1,1,1,1,1,1,null,1,1,null,null,1,1,1,1,1,null,null,1,1,null,1,1,null,1,1,1,1,1,1,1,1,null,null,1,1,null,1,1,null,1,1,1,1,1,1,1,1,null,null,1,1,1,1,1,1,1,1,null,1,1,null,1,1,1,1,1,null,1,1,1,1,1,1,1,1,null,null,1,1,null,1,1,1,1,1,1,1,1,null,null,1,1,1,1,1,1,1,1,1,1,1,null,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,null,1,1,null,1,1,1,null,null,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,null,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,null,null,null,1,1,null,1,1,1,1,null,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,null,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,null,null,1,1,null,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,null,1,1,null,1,1,1,null,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,null,null,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,1,1,null,1,1,null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,null,null,1,1],"linenum":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,58,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,58,26,58,67,58,67,null,58,67,null,null,58,67,26,58,67,null,null,58,67,null,58,67,null,58,67,29,58,67,27,58,67,null,null,58,67,null,58,67,null,58,67,29,58,67,26,58,67,null,null,58,67,29,58,67,29,58,67,null,58,67,null,58,67,28,58,67,null,58,67,27,58,67,28,58,67,null,null,58,67,null,27,58,67,58,67,26,58,67,null,null,58,67,26,58,67,29,58,67,29,58,67,null,null,27,58,67,17,58,67,29,29,58,67,29,58,67,8,24,58,67,28,58,67,null,27,58,67,28,58,67,29,58,67,null,58,67,null,29,58,67,null,null,58,67,null,58,67,24,58,67,26,58,67,27,58,67,27,58,67,16,58,67,28,58,67,29,58,67,24,58,67,27,58,67,31,58,67,27,58,67,31,58,67,null,17,58,67,null,58,67,28,58,67,null,58,67,22,58,67,29,58,67,29,58,67,null,29,58,67,29,58,67,null,null,null,58,67,null,4,24,58,67,null,null,58,67,58,67,27,58,67,27,58,67,27,58,67,28,58,67,29,58,67,22,58,67,27,58,67,16,58,67,null,58,67,26,58,67,28,58,67,null,29,58,67,27,58,67,null,58,67,31,58,67,28,58,67,27,58,67,14,58,67,null,58,67,31,58,67,31,null,27,58,67,26,58,67,null,58,67,29,58,67,27,58,67,null,null,58,67,null,58,67,null,58,67,26,58,67,29,58,67,27,58,67,56,67,58,67,26,58,67,null,58,67,29,58,67,null,58,67,null,27,58,67,null,58,67,29,58,67,null,26,58,67,28,58,67,27,27,58,67,28,58,67,null,null,58,67,null,58,67,31,29,58,67,31,58,67,67,27,58,67,null,8,24,58,67,28,58,67,null,27,58,67,28,58,67,28,58,67,6,24,58,67,24,58,67,29,58,67,29,58,67,29,58,67,28,58,67,27,58,67,29,58,67,26,58,67,null,58,67,null,58,67,null,58,67,29,58,67,26,58,67,8,24,58,67,28,58,67,null,null,58,67],"memalloc":[30.14094543457031,30.14094543457031,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.57091522216797,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,30.86147308349609,31.13811492919922,31.13811492919922,31.13811492919922,31.37388610839844,31.37388610839844,31.74516296386719,31.74516296386719,31.74516296386719,32.02085113525391,32.02085113525391,32.02085113525391,32.02085113525391,32.29081726074219,32.29081726074219,32.29081726074219,30.41656494140625,30.41656494140625,30.41656494140625,30.41656494140625,30.70807647705078,30.70807647705078,30.70807647705078,30.98796081542969,30.98796081542969,30.98796081542969,31.28584289550781,31.28584289550781,31.28584289550781,31.58282470703125,31.58282470703125,31.58282470703125,31.84078216552734,31.84078216552734,31.84078216552734,31.84078216552734,32.09938812255859,32.09938812255859,32.09938812255859,30.45186614990234,30.45186614990234,30.45186614990234,30.76271820068359,30.76271820068359,30.76271820068359,31.08222198486328,31.08222198486328,31.08222198486328,31.38722991943359,31.38722991943359,31.38722991943359,31.38722991943359,31.69126129150391,31.69126129150391,31.69126129150391,32.00830078125,32.00830078125,32.00830078125,30.18871307373047,30.18871307373047,30.18871307373047,30.50300598144531,30.50300598144531,30.50300598144531,30.81498718261719,30.81498718261719,30.81498718261719,31.11479949951172,31.11479949951172,31.11479949951172,31.42015075683594,31.42015075683594,31.42015075683594,31.71554565429688,31.71554565429688,31.71554565429688,32.00251007080078,32.00251007080078,32.00251007080078,32.00251007080078,30.15826416015625,30.15826416015625,30.15826416015625,30.15826416015625,30.35948181152344,30.35948181152344,30.67125701904297,30.67125701904297,30.67125701904297,30.96162414550781,30.96162414550781,30.96162414550781,30.96162414550781,31.37901306152344,31.37901306152344,31.37901306152344,31.6737060546875,31.6737060546875,31.6737060546875,31.94611358642578,31.94611358642578,31.94611358642578,32.20368194580078,32.20368194580078,30.43413543701172,30.43413543701172,30.43413543701172,30.75627136230469,30.75627136230469,30.75627136230469,31.12942504882812,31.12942504882812,31.12942504882812,31.12942504882812,31.36641693115234,31.36641693115234,31.36641693115234,31.65238189697266,31.65238189697266,31.65238189697266,31.65238189697266,31.93450164794922,31.93450164794922,31.93450164794922,32.19997406005859,32.19997406005859,32.19997406005859,32.19997406005859,30.48606872558594,30.48606872558594,30.48606872558594,30.78744506835938,30.78744506835938,30.78744506835938,31.20429992675781,31.20429992675781,31.20429992675781,31.51480865478516,31.80104064941406,31.80104064941406,31.80104064941406,32.10581207275391,32.10581207275391,32.10581207275391,32.10581207275391,30.30207824707031,30.30207824707031,30.30207824707031,30.63027191162109,30.63027191162109,30.63027191162109,30.93167114257812,30.93167114257812,30.93167114257812,31.23153686523438,31.23153686523438,31.23153686523438,31.53957366943359,31.53957366943359,31.53957366943359,31.84018707275391,31.84018707275391,31.84018707275391,32.15101623535156,32.15101623535156,32.15101623535156,30.33432006835938,30.33432006835938,30.33432006835938,30.64726257324219,30.64726257324219,30.64726257324219,30.92885589599609,30.92885589599609,30.92885589599609,31.34069061279297,31.34069061279297,31.34069061279297,31.66384124755859,31.66384124755859,31.66384124755859,31.95883941650391,31.95883941650391,31.95883941650391,32.21923065185547,32.21923065185547,32.21923065185547,32.21923065185547,30.46233367919922,30.46233367919922,30.46233367919922,30.81364440917969,30.81364440917969,30.81364440917969,31.06935119628906,31.06935119628906,31.06935119628906,31.37625122070312,31.37625122070312,31.37625122070312,31.65306091308594,31.65306091308594,31.65306091308594,31.92920684814453,31.92920684814453,31.92920684814453,32.21543884277344,32.21543884277344,32.21543884277344,32.21543884277344,30.46321105957031,30.46321105957031,30.46321105957031,30.78904724121094,31.24330139160156,31.24330139160156,31.24330139160156,31.24330139160156,31.53768920898438,31.85107421875,31.85107421875,31.85107421875,31.85107421875,32.12143707275391,30.24759674072266,30.24759674072266,30.24759674072266,30.56667327880859,30.56667327880859,30.87294006347656,30.87294006347656,30.87294006347656,31.15081787109375,31.15081787109375,31.15081787109375,31.43717193603516,31.43717193603516,31.43717193603516,31.73712158203125,31.73712158203125,31.73712158203125,32.03128051757812,32.03128051757812,32.03128051757812,30.23190307617188,30.23190307617188,30.23190307617188,30.53693389892578,30.53693389892578,30.53693389892578,31.01134490966797,31.01134490966797,31.01134490966797,31.30248260498047,31.30248260498047,31.30248260498047,31.6107177734375,31.6107177734375,31.6107177734375,31.91266632080078,31.91266632080078,31.91266632080078,32.23473358154297,32.23473358154297,32.23473358154297,32.23473358154297,30.44954681396484,30.44954681396484,30.44954681396484,30.72881317138672,30.72881317138672,30.72881317138672,31.0242919921875,31.0242919921875,31.0242919921875,31.31739807128906,31.31739807128906,31.31739807128906,31.62124633789062,31.62124633789062,31.62124633789062,31.91275024414062,31.91275024414062,31.91275024414062,32.20718383789062,32.20718383789062,32.20718383789062,30.40584564208984,30.40584564208984,30.40584564208984,30.72946166992188,31.19792938232422,31.50697326660156,31.50697326660156,31.50697326660156,31.83423614501953,31.83423614501953,31.83423614501953,32.1441650390625,32.1441650390625,32.1441650390625,30.35176086425781,30.35176086425781,30.35176086425781,30.6650390625,30.6650390625,30.6650390625,30.96224212646484,30.96224212646484,30.96224212646484,30.96224212646484,31.27522277832031,31.27522277832031,31.27522277832031,31.56880187988281,31.56880187988281,31.56880187988281,31.86305999755859,31.86305999755859,31.86305999755859,32.17095947265625,32.17095947265625,32.17095947265625,30.36850738525391,30.36850738525391,30.36850738525391,30.81223297119141,30.81223297119141,31.11756896972656,31.11756896972656,31.44145965576172,31.44145965576172,31.44145965576172,31.73476409912109,31.73476409912109,31.73476409912109,32.03699493408203,32.03699493408203,32.03699493408203,30.23920440673828,30.23920440673828,30.23920440673828,30.54854583740234,30.90701293945312,30.90701293945312,30.90701293945312,31.12140655517578,31.12140655517578,31.12140655517578,31.44072723388672,31.44072723388672,31.44072723388672,31.74601745605469,32.02626037597656,32.02626037597656,32.02626037597656,30.23167419433594,30.23167419433594,30.23167419433594,30.56205749511719,30.56205749511719,30.56205749511719,30.56205749511719,30.95977783203125,30.95977783203125,30.95977783203125,31.24554443359375,31.24554443359375,31.24554443359375,31.24554443359375,31.57624053955078,31.57624053955078,31.57624053955078,31.87802124023438,32.16558837890625,32.16558837890625,32.16558837890625,30.38948822021484,30.38948822021484,30.38948822021484,30.68300628662109,30.99034881591797,30.99034881591797,30.99034881591797,31.40455627441406,31.58051300048828,31.58051300048828,31.58051300048828,31.58051300048828,31.87168884277344,31.87168884277344,31.87168884277344,32.26194763183594,32.26194763183594,32.26194763183594,32.26194763183594,30.5025634765625,30.5025634765625,30.5025634765625,30.796142578125,30.796142578125,30.796142578125,31.08552551269531,31.08552551269531,31.08552551269531,31.08552551269531,31.37808990478516,31.37808990478516,31.37808990478516,31.69638061523438,31.69638061523438,31.69638061523438,31.96925354003906,31.96925354003906,31.96925354003906,32.24203491210938,32.24203491210938,32.24203491210938,30.44669342041016,30.44669342041016,30.44669342041016,30.76078796386719,30.76078796386719,30.76078796386719,30.97534942626953,30.97534942626953,30.97534942626953,31.31918334960938,31.31918334960938,31.31918334960938,31.78664398193359,31.78664398193359,31.78664398193359,32.09427642822266,32.09427642822266,32.09427642822266,30.32160949707031,30.32160949707031,30.32160949707031,30.63723754882812,30.63723754882812,30.63723754882812,30.92695617675781,30.92695617675781,30.92695617675781,31.19934844970703,31.19934844970703,31.19934844970703,31.19934844970703,31.50343322753906,31.50343322753906,31.50343322753906,31.82476806640625,31.82476806640625,31.82476806640625,31.82476806640625],"meminc":[0,0,0.4299697875976562,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.290557861328125,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.276641845703125,0,0,0.2357711791992188,0,0.37127685546875,0,0,0.2756881713867188,0,0,0,0.2699661254882812,0,0,-1.874252319335938,0,0,0,0.2915115356445312,0,0,0.2798843383789062,0,0,0.297882080078125,0,0,0.2969818115234375,0,0,0.2579574584960938,0,0,0,0.25860595703125,0,0,-1.64752197265625,0,0,0.31085205078125,0,0,0.3195037841796875,0,0,0.3050079345703125,0,0,0,0.3040313720703125,0,0,0.3170394897460938,0,0,-1.819587707519531,0,0,0.3142929077148438,0,0,0.311981201171875,0,0,0.2998123168945312,0,0,0.3053512573242188,0,0,0.2953948974609375,0,0,0.2869644165039062,0,0,0,-1.844245910644531,0,0,0,0.2012176513671875,0,0.3117752075195312,0,0,0.2903671264648438,0,0,0,0.417388916015625,0,0,0.2946929931640625,0,0,0.2724075317382812,0,0,0.257568359375,0,-1.769546508789062,0,0,0.3221359252929688,0,0,0.3731536865234375,0,0,0,0.2369918823242188,0,0,0.2859649658203125,0,0,0,0.2821197509765625,0,0,0.265472412109375,0,0,0,-1.713905334472656,0,0,0.3013763427734375,0,0,0.4168548583984375,0,0,0.3105087280273438,0.2862319946289062,0,0,0.3047714233398438,0,0,0,-1.803733825683594,0,0,0.3281936645507812,0,0,0.3013992309570312,0,0,0.29986572265625,0,0,0.3080368041992188,0,0,0.3006134033203125,0,0,0.3108291625976562,0,0,-1.816696166992188,0,0,0.3129425048828125,0,0,0.2815933227539062,0,0,0.411834716796875,0,0,0.323150634765625,0,0,0.2949981689453125,0,0,0.2603912353515625,0,0,0,-1.75689697265625,0,0,0.3513107299804688,0,0,0.255706787109375,0,0,0.3069000244140625,0,0,0.2768096923828125,0,0,0.2761459350585938,0,0,0.2862319946289062,0,0,0,-1.752227783203125,0,0,0.325836181640625,0.454254150390625,0,0,0,0.2943878173828125,0.313385009765625,0,0,0,0.2703628540039062,-1.87384033203125,0,0,0.3190765380859375,0,0.3062667846679688,0,0,0.2778778076171875,0,0,0.2863540649414062,0,0,0.2999496459960938,0,0,0.294158935546875,0,0,-1.79937744140625,0,0,0.3050308227539062,0,0,0.4744110107421875,0,0,0.2911376953125,0,0,0.3082351684570312,0,0,0.3019485473632812,0,0,0.3220672607421875,0,0,0,-1.785186767578125,0,0,0.279266357421875,0,0,0.2954788208007812,0,0,0.2931060791015625,0,0,0.3038482666015625,0,0,0.29150390625,0,0,0.29443359375,0,0,-1.801338195800781,0,0,0.3236160278320312,0.4684677124023438,0.3090438842773438,0,0,0.3272628784179688,0,0,0.3099288940429688,0,0,-1.792404174804688,0,0,0.3132781982421875,0,0,0.2972030639648438,0,0,0,0.3129806518554688,0,0,0.2935791015625,0,0,0.2942581176757812,0,0,0.3078994750976562,0,0,-1.802452087402344,0,0,0.4437255859375,0,0.3053359985351562,0,0.3238906860351562,0,0,0.293304443359375,0,0,0.3022308349609375,0,0,-1.79779052734375,0,0,0.3093414306640625,0.3584671020507812,0,0,0.2143936157226562,0,0,0.3193206787109375,0,0,0.3052902221679688,0.280242919921875,0,0,-1.794586181640625,0,0,0.33038330078125,0,0,0,0.3977203369140625,0,0,0.2857666015625,0,0,0,0.3306961059570312,0,0,0.3017807006835938,0.287567138671875,0,0,-1.776100158691406,0,0,0.29351806640625,0.307342529296875,0,0,0.4142074584960938,0.1759567260742188,0,0,0,0.2911758422851562,0,0,0.3902587890625,0,0,0,-1.759384155273438,0,0,0.2935791015625,0,0,0.2893829345703125,0,0,0,0.2925643920898438,0,0,0.3182907104492188,0,0,0.2728729248046875,0,0,0.2727813720703125,0,0,-1.795341491699219,0,0,0.3140945434570312,0,0,0.2145614624023438,0,0,0.3438339233398438,0,0,0.4674606323242188,0,0,0.3076324462890625,0,0,-1.772666931152344,0,0,0.3156280517578125,0,0,0.2897186279296875,0,0,0.2723922729492188,0,0,0,0.3040847778320312,0,0,0.3213348388671875,0,0,0],"filename":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"<expr>",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>",null,"<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>","<expr>",null,null,"<expr>","<expr>"]},"interval":10,"files":[{"filename":"<expr>","content":"profvis({\nf <- function(x, par){\n  alpha <- par[1]\n  beta <- par[2]\n  gamma <- par[3]\n  rho <- par[4]\n  \n  return(gamma + (rho - gamma) / (1 + exp(beta * log(x) - alpha)))\n}\n\n\n\ngradient <- function(par, i, x, y,...){\n  alpha <- par[1]\n  beta <- par[2]\n  gamma <- par[3]\n  rho <- par[4]\n  \n  x_i <- x[i]\n  y_i <- y[i]\n  \n  expbetalogxalpha <- exp(beta * log(x_i) - alpha)\n  \n  identical_part <- - 2 * (y_i - f(x_i, par))\n  \n  grad_alpha <- mean(identical_part * (rho - gamma) * expbetalogxalpha / (1 + expbetalogxalpha)^2)\n  grad_beta <- - mean(identical_part * (rho - gamma) * log(x[i]) * expbetalogxalpha / (1 + expbetalogxalpha)^2)\n  grad_gamma <- mean(identical_part * (1 - 1 / (1 + expbetalogxalpha)))\n  grad_rho <- mean(identical_part / (1 + expbetalogxalpha))\n  \n  return(c(grad_alpha, grad_beta, grad_gamma, grad_rho))\n}\n\nsgd <- function(\n    par0,\n    grad,\n    N, # Sample size\n    gamma, # Decay schedule or a fixed learning rate\n    epoch = NULL,\n    maxiter = 100, # Max epoch iterations\n    sampler = sample, # How data is resampled. Default is a random permutation\n    cb = NULL,\n    ...) {\n  \n  if (is.function(gamma)) gamma <- gamma(1:maxiter)\n  gamma <- rep_len(gamma, maxiter)\n  \n  par <- par0\n  \n  for (n in 1:maxiter) {\n    if (!is.null(cb)) cb$tracer()\n    \n    samp <- sampler(N)\n    \n    if (is.null(epoch)){\n       for (j in 1:N) {\n         i <- samp[j]\n        par <- par - gamma[n] * grad(par, i, ...)\n       }\n    } else {\n      par <- epoch(par, samp, gamma[n], ...)\n    }\n  }\n  par\n}\n\nsgd(c(3,3,3,3), grad = gradient, N = 1000, gamma = 0.01, x = sim_1$x, y = sim_1$y)\n})","normpath":"<expr>"}],"prof_output":"C:\\Users\\birgi\\AppData\\Local\\Temp\\RtmpMJF3E4\\file35c461bf381e.prof","highlight":{"output":["^output\\$"],"gc":["^<GC>$"],"stacktrace":["^\\.\\.stacktraceo(n|ff)\\.\\.$"]},"split":"h"}},"evals":[],"jsHooks":[]}</script>
---
###Implementing the gradient function in RCPP

``` r
library(Rcpp)

cppFunction('
NumericVector gradient_rcpp(NumericVector par, NumericVector indices, NumericVector x, NumericVector y) {
  // Extract parameters
  double alpha = par[0];
  double beta = par[1];
  double gamma = par[2];
  double rho = par[3];

  // Initialize gradients
  double grad_alpha = 0.0;
  double grad_beta = 0.0;
  double grad_gamma = 0.0;
  double grad_rho = 0.0;

  int n = indices.size(); // Number of indices

  // Loop over the indices
  for (int idx = 0; idx &lt; n; ++idx) {
    int i = indices[idx] - 1;  // Convert from r to c++ indexing

    // Get individual data point
    double x_i = x[i];
    double y_i = y[i];

    // Calculating f(x_i, par)
    double f_x_i = gamma + (rho - gamma) / (1 + exp(beta * log(x_i) - alpha));

    // Exponential term
    double expbetalogxalpha = exp(beta * log(x_i) - alpha);

    // Identical part used in gradients
    double identical_part = -2 * (y_i - f_x_i);

    // Accumulate gradients for all indices
    grad_alpha += (identical_part * (rho - gamma) * expbetalogxalpha) 
    / pow(1 + expbetalogxalpha, 2);
    grad_beta += -(identical_part * (rho - gamma) * log(x_i) * expbetalogxalpha) 
    / pow(1 + expbetalogxalpha, 2);
    grad_gamma += identical_part * (1 - 1 / (1 + expbetalogxalpha));
    grad_rho += identical_part / (1 + expbetalogxalpha);
  }

  // Return the mean of accumulated gradients
  return NumericVector::create(grad_alpha / n, grad_beta / n, grad_gamma / n, grad_rho / n);
}
')
```


``` r
gradient(c(3,3,3,3), c(1,2), sim_1$x, sim_1$y)
```

```
## [1]  0.0000000  0.0000000 -0.1090435  0.7587501
```

``` r
gradient_rcpp(c(3,3,3,3), c(1,2), sim_1$x, sim_1$y)
```

```
## [1]  0.0000000  0.0000000 -0.1090435  0.7587501
```


---
###Exploiting the grid structure?

---
###Benchmarking
Benchmarking the RCPP implementation against the R implementation
&lt;img src="4---Presentation_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;
&lt;br&gt;

|expression |     min|  median|   itr.sec| mem_alloc|    gc.sec| n_itr| n_gc| total_time|
|:----------|-------:|-------:|---------:|---------:|---------:|-----:|----:|----------:|
|R          | 232.7ms| 247.3ms|  3.991337|    89.1KB|  9.858603|   100|  247|     25.05s|
|Rcpp       |  21.6ms|  24.2ms| 40.714824|    94.4KB| 10.993002|   100|   27|      2.46s|

---
&lt;img src="4---Presentation_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

|expression |      min|  median|  itr.sec| mem_alloc|   gc.sec| n_itr| n_gc| total_time|
|:----------|--------:|-------:|--------:|---------:|--------:|-----:|----:|----------:|
|R          |    2.42s|    2.5s| 0.389783|     792KB| 12.04429|    10|  309|     25.66s|
|Rcpp       | 232.37ms| 240.7ms| 4.043943|     792KB| 13.74941|    10|   34|      2.47s|
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"highlightSpans": true,
"ratio": "16:9",
"countIncrementalSlides": true,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
